(function(e,t){typeof define=="function"&&define.amd?define([],t):e.MOJO=t()})(this,function(){var e,t,n,r;(function(){var i={},s={};e=function(e,t,n){i[e]={deps:t,callback:n}},r=n=t=function(e){function p(t){if(t.charAt(0)!==".")return t;var n=t.split("/"),r=e.split("/").slice(0,-1);for(var i=0,s=n.length;i<s;i++){var o=n[i];if(o==="..")r.pop();else{if(o===".")continue;r.push(o)}}return r.join("/")}r._eak_seen=i;if(s[e])return s[e];s[e]={};if(!i[e])throw new Error("Could not find module "+e);var n=i[e],o=n.deps,u=n.callback,a=[],f;for(var l=0,c=o.length;l<c;l++)o[l]==="exports"?a.push(f={}):a.push(t(p(o[l])));var h=u.apply(this,a);return s[e]=f||h}})(),e("transpiler",function(){}),e("MOJO",[],function(){function e(e){var t=this;t.__init(t,e||{})}return e}),e("shared",[],function(){function r(e){return e.length}function i(e){return Array.isArray(e)}function s(t){return i(t)?t:t!==e?[t]:[]}function o(e,t){return s(e).forEach(t)}var e,t="prototype",n="handleMOJO";return{EVENTS:{$set:"$$set",$unset:"$$unset",$when:"$$listener.added",$emit:"$$listener.triggered",$dispel:"$$listener.removed",$deref:"$$deref"},length:r,isArray:i,ensureArray:s,forEach:o,ocreate:function(e){return Object.create(e)},defProp:function(e,t,n){Object.defineProperty(e,t,n)},del:function(e,t){delete e[t]},keys:function(e){return Object.keys(e)},shift:function(e){return Array[t].shift.call(e)},pop:function(e){return Array[t].pop.call(e)},slice:function(e,n,r){return Array[t].slice.call(e,n,r)},last:function(e){return e[r(e)-1]},is:function(e,t){return typeof t=="string"?typeof e===t:e instanceof t},has:function(e,t){return e.hasOwnProperty(t)},ensureFunc:function(e){return e||function(){}},getHandlerFunc:function(e){return(e||{})[n]?e[n]:e}}}),e("inject",["MOJO","shared"],function(e,t){function r(e,r){var i=this;return e=e.map(function(e){var r;return n(e,"string")?r=t[e]:r=e,r}),r.apply(null,e)}var n=t.is;return r}),e("Event",["inject"],function(e){return e([Date,"forEach","getHandlerFunc","keys","ocreate"],function(e,t,n,r,i){function f(t,n){var r=this;r.target=t,r.type=n,r[o]=t,r[u]=!1,r[a]=!1,r.timeStamp=e.now()}var s=/^\${2}/,o="currentTarget",u="cancelBubble",a="defaultPrevented";return f.clone=function(e,n){var s=r(e),u=i(e);return t(s,function(t){u[t]=e[t]}),u[o]=n,u},f.isPrivate=function(e){return s.test(e)},f.getPublic=function(e){return e.replace(s,"")},f.prototype={preventDefault:function(){this[a]=!0},stopPropagation:function(){this[u]=!0}},f})}),e("EventHandler",["inject"],function(e){return e(["ensureArray"],function(e){function t(t,n,r){var i=this;i.func=t,i.locked=!1,i.before=function(){},i.after=function(){},r=e(r),i.invoke=function(s,o){if(s.cancelBubble)return;var u=r.slice(0).concat(e(o));u.unshift(s),i.before(s,t),t.apply(n,u),i.after(s,t)}}return t})}),e("when",["inject","MOJO","Event","EventHandler"],function(e,t,n,r){return e(["keys","ocreate","shift","pop","ensureArray","forEach","length","last","ensureFunc","getHandlerFunc","isArray","is","del","EVENTS"],function(e,i,s,o,u,a,f,l,c,h,p,d,v,m){function g(e,t){return u(e).map(function(e){return e.func}).indexOf(t)}function y(e,t){return e===t?null:e}function b(e){var t=Object.keys(m),r;for(var i=0;i<t.length;i++){r=m[t[i]];if(r===e||n.getPublic(r)===e)return!0}}return{$once:function(){var e=this;return e.__when(arguments,function(t){t.before=function(t,n){e.$enq(function(){e.__remove(t.type,n)}),e.$digest()}}),e.$digest(),e},$when:function(){var e=this;return e.__when(arguments),e.$digest(),e},$emit:function(e,t,r){var i=this;return i.$enq(function(){e=i._ensureEType(e),a(e,function(e){var s=i.__get(e),o=r?n.clone(r,i):new n(i,e);a(s,function(e){e.invoke(o,t)}),b(e)||i.$emit(m.$emit,[e,[e,t,o]])})}),i.$digest(),i},$dispel:function(e,t,r){var i=this,s=h(t);return i.$enq(function(){e=i._ensureEType(e),a(e,function(e){(r||!n.isPrivate(e))&&i.__remove(e,s,!!r)})}),i.$digest(),i},__when:function(e,n){n=c(n);var r=this,i=s(e),u=d(l(e),"function")||d(l(e),t)?o(e):r,f=e[0],p=h(u),v=y(u,p);r.$enq(function(){a(i,function(e,t){n(r.__add(e,p,v,f))})})},__get:function(e){var t=this,n=t.handlers;return e?u(n[e]):n},__add:function(e,t,n,i){var s=this,o=new r(t,n,i),u=s.__get(e);return u.push(o),s.handlers[e]=u,b(e)||s.$emit(m.$when,[e,[e,i,t]]),o},__remove:function(e,t,n){var r=this,i=r.__get(),s=r.__get(e),o=0,u,a;while(o<f(s))u=t?g(s,t):o,u>=0&&!s[o].locked&&(s.splice(u,1),o--),o++;f(s)?i[e]=s:v(i,e),b(e)||r.$emit(m.$dispel,[e,[e,t,n]])},_ensureEType:function(t){return t||e(this.handlers)}}})}),e("construct",["inject"],function(e){return e(["keys","defProp","length","EVENTS"],function(e,t,n,r){function o(n){var o=!1;t(n,"__inprog",{get:function(){return o},set:function(e){o=e}}),t(n,"__stack",{value:[]}),t(n,"handlers",{value:{}}),t(n,"watchers",{value:[]}),t(n,i,{value:n[i].bind(n)}),t(n,s,{value:n[s].bind(n)}),e(r).forEach(function(e){var t=r[e],i=n.__add(t,n[s],n);i.locked=!0})}var i="handleMOJO",s="__"+i;return o})}),e("proto",["MOJO","inject","Event","when","construct"],function(e,t,n,r,i){return t([Error,"ocreate","shift","pop","slice","length","is","del","EVENTS"],function(t,s,o,u,a,f,l,c,h){var p=s(r);return p.__init=function(e,t){for(var n in t)e[n]=t[n];i(e)},p.__handleMOJO=function(){var e=this,t=a(arguments),r=o(t),i=o(t),s=u(t),f=n.getPublic(r.type)!==i;f&&e.$emit(n.getPublic(r.type),s),r.type===h.$emit&&!n.isPrivate(i)&&e.watchers.forEach(function(e){e.$emit.apply(e,s)}),r.type===h.$emit&&n.isPrivate(i)&&e.$emit(n.getPublic(i),s[1])},p.handleMOJO=function(){},p.$set=function(e,t){var n=this;return n[e]=t,n.$emit(h.$set,[e,[e]]),n},p.$unset=function(e){var t=this;return c(t,e),t.$emit(h.$unset,[e,[e]]),t},p.$watch=function(n){var r=this;if(!l(n,e))throw new t("parent must be a MOJO");var i=n.watchers;return i.indexOf(r)<0&&(i.push(r),r.$once(h.$deref,function(e){var t=i.indexOf(r);t>=0&&i.splice(t,1)})),r},p.$deref=function(){var e=this;e.$emit(h.$deref)},p.$enq=function(e){var t=this;t.__stack.push(e)},p.$digest=function(){var e=this,t=e.__stack;if(e.__inprog)return;e.__inprog=!0;while(f(t)>0)o(t)();e.__inprog=!1},p})}),e("create",["inject","proto"],function(e,t){return e(["ocreate"],function(e){function n(n){var r=e(t);for(var i in n)r[i]=n[i];return r}return n})}),e("aggregate",["inject","MOJO","Event"],function(e,t,n){return e([Error,"keys","forEach","EVENTS"],function(e,r,i,s){function o(o){var u=new t;return i(o,function(t){i(r(s),function(r){u.$when(s[r],function(i,s,o){if(n.isPrivate(s))throw new e("private events cannot be aggregated");t[r].apply(t,o)})})}),u}return o})});var i=n("MOJO");return i.prototype=n("proto"),i.shared=n("shared"),i.create=n("create"),i.construct=n("construct"),i.aggregate=n("aggregate"),i.Event=n("Event"),i.EventHandler=n("EventHandler"),i});