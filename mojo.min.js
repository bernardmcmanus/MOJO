(function(e,t){typeof define=="function"&&define.amd?define([],t):e.MOJO=t()})(this,function(){function p(e){return e.length}function d(e,t){return e.indexOf(t)}function v(e){return i.isArray(e)}function m(e){return v(e)?e:e!==c?[e]:[]}function g(e,t){return m(e).forEach(t)}function y(e){return s.create(e)}function b(e,t,n){s.defineProperty(e,t,n)}function w(e,t){delete e[t]}function E(e){return s.keys(e)}function S(e){return i[a].shift.call(e)}function x(e){return i[a].pop.call(e)}function T(e,t,n){return i[a].slice.call(e,t,n)}function N(e){return e[p(e)-1]}function C(e,t){return typeof t=="string"?typeof e===t:e instanceof t}function k(e,t){return e.hasOwnProperty(t)}function L(e){return e||function(){}}function A(e){return(e||{})[f]?e[f]:e}function O(e,t){return e===t?null:e}var e,t,n,r;(function(){var i={},s={};e=function(e,t,n){i[e]={deps:t,callback:n}},r=n=t=function(e){function p(t){if(t.charAt(0)!==".")return t;var n=t.split("/"),r=e.split("/").slice(0,-1);for(var i=0,s=n.length;i<s;i++){var o=n[i];if(o==="..")r.pop();else{if(o===".")continue;r.push(o)}}return r.join("/")}r._eak_seen=i;if(s[e])return s[e];s[e]={};if(!i[e])throw new Error("Could not find module "+e);var n=i[e],o=n.deps,u=n.callback,a=[],f;for(var l=0,c=o.length;l<c;l++)o[l]==="exports"?a.push(f={}):a.push(t(p(o[l])));var h=u.apply(this,a);return s[e]=f||h}})(),e("transpiler",function(){});var i=Array,s=Object,o=Date,u=Error,a="prototype",f="handleMOJO",l="__"+f,c,h={$set:"$$set",$unset:"$$unset",$when:"$$listener.added",$emit:"$$listener.triggered",$dispel:"$$listener.removed",$deref:"$$deref"};e("shared",function(){}),e("MOJO",[],function(){function e(e){var t=this;t.__init(t,e||{})}return e}),e("Event",[],function(){function i(e,i){var s=this;s.target=e,s.type=i,s[t]=e,s[n]=!1,s[r]=!1,s.timeStamp=o.now()}var e=/^\${2}/,t="currentTarget",n="cancelBubble",r="defaultPrevented";return i.clone=function(e,n){var r=E(e),i=y(e);return g(r,function(t){i[t]=e[t]}),i[t]=n,i},i.isPrivate=function(t){return e.test(t)},i.getPublic=function(t){return t.replace(e,"")},i[a]={preventDefault:function(){this[r]=!0},stopPropagation:function(){this[n]=!0}},i}),e("EventHandler",[],function(){function e(e,t,n){var r=this;r.func=e,r.locked=!1,r.before=function(){},r.after=function(){},n=m(n),r.invoke=function(i,s){if(i.cancelBubble)return;var o=T(n).concat(m(s));o.unshift(i),r.before(i,e),e.apply(t,o),r.after(i,e)}}return e}),e("when",["MOJO","Event","EventHandler"],function(e,t,n){function r(e,t){return m(e).map(function(e){return e.func}).indexOf(t)}function i(e){var n,r=E(h);for(var i=0;i<p(r);i++){n=h[r[i]];if(n===e||t.getPublic(n)===e)return!0}}return{$once:function(){var e=this;return e.__when(arguments,function(t){t.before=function(t,n){e.$enq(function(){e.__remove(t.type,n)}),e.$digest()}}),e.$digest(),e},$when:function(){var e=this;return e.__when(arguments),e.$digest(),e},$emit:function(e,n,r){var s=this;return s.$enq(function(){e=e||s.__events,g(e,function(e){var o=s.__get(e),u=r?t.clone(r,s):new t(s,e);g(o,function(e){e.invoke(u,n)}),i(e)||s.$emit(h.$emit,[e,[e,n,u]])})}),s.$digest(),s},$dispel:function(e,n,r){var i=this,s=A(n);return i.$enq(function(){e=e||i.__events,g(e,function(e){(r||!t.isPrivate(e))&&i.__remove(e,s,!!r)})}),i.$digest(),i},__when:function(t,n){n=L(n);var r=this,i=S(t),s=C(N(t),"function")||C(N(t),e)?x(t):r,o=t[0],u=A(s),a=O(s,u);r.$enq(function(){g(i,function(e,t){n(r.__add(e,u,a,o))})})},__get:function(e){var t=this,n=t.handlers;return e?m(n[e]):n},__add:function(e,t,r,s){var o=this,u=new n(t,r,s),a=o.__get(e);return a.push(u),o.handlers[e]=a,i(e)||o.$emit(h.$when,[e,[e,s,t]]),u},__remove:function(e,t,n){var s=this,o=s.__get(),u=s.__get(e),a=0,f,l;while(a<p(u))f=t?r(u,t):a,f>=0&&!u[a].locked&&(u.splice(f,1),a--),a++;p(u)?o[e]=u:w(o,e),i(e)||s.$emit(h.$dispel,[e,[e,t,n]])}}}),e("construct",[],function(){return function(e){var t=!1;b(e,"__stack",{value:[]}),b(e,"__inprog",{get:function(){return t},set:function(e){t=e}}),b(e,"__events",{get:function(){return E(e.handlers)}}),b(e,"handlers",{value:{}}),b(e,"watchers",{value:[]}),b(e,f,{value:L(e[f]).bind(e)}),b(e,l,{value:e[l].bind(e)}),g(E(h),function(t){var n=h[t],r=e.__add(n,e[l],e);r.locked=!0})}}),e("proto",["MOJO","Event","when","construct"],function(e,t,n,r){var i=y(n);return i.__init=function(e,t){for(var n in t)e[n]=t[n];r(e)},i[l]=function(){var e=this,n=T(arguments),r=S(n),i=S(n),s=x(n),o=t.getPublic(r.type)!==i;o&&e.$emit(t.getPublic(r.type),s),r.type===h.$emit&&!t.isPrivate(i)&&g(e.watchers,function(e){e.$emit.apply(e,s)}),r.type===h.$emit&&t.isPrivate(i)&&e.$emit(t.getPublic(i),s[1])},i.$set=function(e,t){var n=this;return n[e]=t,n.$emit(h.$set,[e,[e]]),n},i.$unset=function(e){var t=this;return w(t,e),t.$emit(h.$unset,[e,[e]]),t},i.$watch=function(t){var n=this;if(!C(t,e))throw new u("parent must be a MOJO");var r=t.watchers,i=d(r,n);return i<0&&(r.push(n),n.$once(h.$deref,function(e){i>=0&&r.splice(i,1)})),n},i.$deref=function(){var e=this;e.$emit(h.$deref)},i.$enq=function(e){var t=this;t.__stack.push(e)},i.$digest=function(){var e=this,t=e.__stack;if(e.__inprog)return;e.__inprog=!0;while(p(t)>0)S(t)();e.__inprog=!1},i}),e("create",["proto"],function(e){return function(t){var n=y(e);for(var r in t)n[r]=t[r];return n}}),e("aggregate",["MOJO","Event"],function(e,t){return function(n){var r=new e;return g(n,function(e){g(E(h),function(n){r.$when(h[n],function(r,i,s){if(t.isPrivate(i))throw new u("private events cannot be aggregated");e[n].apply(e,s)})})}),r}});var M=n("MOJO");return M.prototype=n("proto"),M.create=n("create"),M.construct=n("construct"),M.aggregate=n("aggregate"),M.Event=n("Event"),M.EventHandler=n("EventHandler"),M.$_EVT=h,M});