/*! mojo - 0.2.0 - Bernard McManus - working - gcbb508 - 2014-10-24 */
function MOJO(a){var b=this;b.__init(b,a||{})}MOJO.__ready=function(){MOJO.inject("prototype",[Error,MOJO,"Event","when","construct","ocreate","shift","pop","slice","length","is","del","EVENTS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=f(d);return n.__init=function(a,b){for(var c in b)a[c]=b[c];e(a)},n.__handleMOJO=function(){var a=this,b=i(arguments),d=g(b),e=g(b),f=h(b),j=c.getPublic(d.type)!==e;j&&a.$emit(c.getPublic(d.type),f),d.type!==m.$emit||c.isPrivate(e)||a.watchers.forEach(function(a){a.$emit.apply(a,f)}),d.type===m.$emit&&c.isPrivate(e)&&a.$emit(c.getPublic(e),f[1])},n.handleMOJO=function(){},n.$set=function(a,b){var c=this;return c[a]=b,c.$emit(m.$set,[a,[a]]),c},n.$unset=function(a){var b=this;return l(b,a),b.$emit(m.$unset,[a,[a]]),b},n.$watch=function(c){var d=this;if(!k(c,b))throw new a("parent must be a MOJO");var e=c.watchers;return e.indexOf(d)<0&&(e.push(d),d.$once(m.$deref,function(){var a=e.indexOf(d);a>=0&&e.splice(a,1)})),d},n.$deref=function(){var a=this;a.$emit(m.$deref)},n.$enq=function(a){var b=this;b.__stack.push(a)},n.$digest=function(){var a=this,b=a.__stack;if(!a.__inprog){for(a.__inprog=!0;j(b)>0;)g(b)();a.__inprog=!1}},l(b,"__ready"),n})},MOJO.shared=function(a,b){function c(a){return a.length}function d(a){return b.isArray(a)}function e(a){return d(a)?a:a!==g?[a]:[]}function f(a,b){return e(a).forEach(b)}var g,h="prototype",i="handleMOJO";return{EVENTS:{$set:"$$set",$unset:"$$unset",$when:"$$listener.added",$emit:"$$listener.triggered",$dispel:"$$listener.removed",$deref:"$$deref"},length:c,isArray:d,ensureArray:e,forEach:f,ocreate:function(b){return a.create(b)},defProp:function(b,c,d){a.defineProperty(b,c,d)},del:function(a,b){delete a[b]},keys:function(b){return a.keys(b)},shift:function(a){return b[h].shift.call(a)},pop:function(a){return b[h].pop.call(a)},slice:function(a,c,d){return b[h].slice.call(a,c,d)},last:function(a){return a[c(a)-1]},is:function(a,b){return"string"==typeof b?typeof a===b:a instanceof b},has:function(a,b){return a.hasOwnProperty(b)},ensureFunc:function(a){return a||function(){}},getHandlerFunc:function(a){return(a||{})[i]?a[i]:a}}}(Object,Array),MOJO.inject=function(a){function b(){var b=arguments,g=d(b),h=d(b),i=d(b);h=h.map(function(b){var d;return d=f(b,"string")?e(c,b)?c[b]:a[b]:b}),a[i]=g.apply(null,h)}var c=a.shared,d=c.pop,e=c.has,f=c.is;return b}(MOJO),MOJO.inject("EventHandler",["ensureArray"],function(a){function b(b,c,d){var e=this;e.func=b,e.locked=!1,e.before=function(){},e.after=function(){},d=a(d),e.invoke=function(f,g){if(!f.cancelBubble){var h=d.slice(0).concat(a(g));h.unshift(f),e.before(f,b),b.apply(c,h),e.after(f,b)}}}return b}),MOJO.inject("Event",[Date,"forEach","getHandlerFunc","keys","ocreate"],function(a,b,c,d,e){function f(b,c){var d=this;d.target=b,d.type=c,d[h]=b,d[i]=!1,d[j]=!1,d.timeStamp=a.now()}var g=/^\${2}/,h="currentTarget",i="cancelBubble",j="defaultPrevented";return f.clone=function(a,c){var f=d(a),g=e(a);return b(f,function(b){g[b]=a[b]}),g[h]=c,g},f.isPrivate=function(a){return g.test(a)},f.getPublic=function(a){return a.replace(g,"")},f.prototype={preventDefault:function(){this[j]=!0},stopPropagation:function(){this[i]=!0}},f}),MOJO.inject("when",["EventHandler","Event","keys","ocreate","shift","pop","ensureArray","forEach","length","last","ensureFunc","getHandlerFunc","isArray","is","del","EVENTS"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,b){return g(a).map(function(a){return a.func}).indexOf(b)}function r(a,b){return a===b?null:a}function s(a){for(var c,d=Object.keys(p),e=0;e<d.length;e++)if(c=p[d[e]],c===a||b.getPublic(c)===a)return!0}return{$once:function(){var a=this;return a.__when(arguments,function(b){b.before=function(b,c){a.$enq(function(){a.__remove(b.type,c)}),a.$digest()}}),a.$digest(),a},$when:function(){var a=this;return a.__when(arguments),a.$digest(),a},$emit:function(a,c,d){var e=this;return e.$enq(function(){a=e._ensureEType(a),h(a,function(a){var f=e.__get(a),g=d?b.clone(d,e):new b(e,a);h(f,function(a){a.invoke(g,c)}),s(a)||e.$emit(p.$emit,[a,[a,c,g]])})}),e.$digest(),e},$dispel:function(a,c,d){var e=this,f=l(c);return e.$enq(function(){a=e._ensureEType(a),h(a,function(a){(d||!b.isPrivate(a))&&e.__remove(a,f,!!d)})}),e.$digest(),e},__when:function(a,b){b=k(b);var c=this,d=e(a),g=n(j(a),"function")||n(j(a),MOJO)?f(a):c,i=a[0],m=l(g),o=r(g,m);c.$enq(function(){h(d,function(a){b(c.__add(a,m,o,i))})})},__get:function(a){var b=this,c=b.handlers;return a?g(c[a]):c},__add:function(b,c,d,e){var f=this,g=new a(c,d,e),h=f.__get(b);return h.push(g),f.handlers[b]=h,s(b)||f.$emit(p.$when,[b,[b,e,c]]),g},__remove:function(a,b,c){for(var d,e=this,f=e.__get(),g=e.__get(a),h=0;h<i(g);)d=b?q(g,b):h,d>=0&&!g[h].locked&&(g.splice(d,1),h--),h++;i(g)?f[a]=g:o(f,a),s(a)||e.$emit(p.$dispel,[a,[a,b,c]])},_ensureEType:function(a){return a||c(this.handlers)}}}),MOJO.inject("create",[MOJO,"ocreate"],function(a,b){function c(c){var d=b(a.prototype);for(var e in c)d[e]=c[e];return d}return c}),MOJO.inject("construct",["keys","defProp","length","EVENTS"],function(a,b,c,d){function e(c){var e=!1;b(c,"__inprog",{get:function(){return e},set:function(a){e=a}}),b(c,"__stack",{value:[]}),b(c,"handlers",{value:{}}),b(c,"watchers",{value:[]}),b(c,f,{value:c[f].bind(c)}),b(c,g,{value:c[g].bind(c)}),a(d).forEach(function(a){var b=d[a],e=c.__add(b,c[g],c);e.locked=!0})}var f="handleMOJO",g="__"+f;return e}),MOJO.inject("aggregate",[Error,MOJO,"Event","keys","forEach","EVENTS"],function(a,b,c,d,e,f){function g(g){var h=new b;return e(g,function(b){e(d(f),function(d){h.$when(f[d],function(e,f,g){if(c.isPrivate(f))throw new a("private events cannot be aggregated");b[d].apply(b,g)})})}),h}return g}),function(a){"object"==typeof exports?module.exports=a:window.MOJO=a,a.__ready()}(MOJO);